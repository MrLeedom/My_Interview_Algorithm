并发编程：并发编程的目的是为了让程序运行的更快，但是并不是启动更多的线程，就能让程序最大限度的并
发执行。在进行并发编程时，如果希望通过多线程执行任务让程序运行的更快，会面临非常多的挑战。比如上下
问切换的问题，死锁的问题，以及受限于硬件和软件的资源限制问题。
1.上下文切换
即使是单核处理器也支持多线程执行代码，cpu通过给每个线程分配cpu时间片来实现这个机制。时间片是cpu分配
给各个线程的时间，因为时间片非常短，所以cpu通过不停的切换线程执行，让我们感觉多个线程是同时执行的，时
间片一般是几十毫秒。
cpu通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下个任务，但是在切换前会保存上一个
任务的状态，以便下次切换回这个任务时，可以再加载这个任务的状态。所以任务的保存到再加载的过程就是一次上
下文切换。
如何减少上下文切换，采用的方法有无锁并发编程、CAS算法、单线程编程和使用协程。
无锁并发编程：多线程竞争锁，会引起上下文切换，所以多线程处理数据时，可以用一些办法来避免使用锁，如将数据用
            ID进行hash算法后分段，不同的线程处理不同段的数据；
CAS算法：Java的atomic包使用CAS算法来更新数据，而不需要加锁；
使用最少线程：避免创建不需要的线程，比如任务很少，但是创建了很多线程来处理，这样会造成大量线程都处于等待状态。
协程：在单线程里实现多任务的调度，并在单线程里维护多个任务间的切换。
2.死锁
锁是个非常有用的工具，运用场景非常多，因为其使用起来非常简单，而且易于理解。但同时它也会带来一些困扰，那就是
可能会引起死锁，一旦产生死锁，会造成系统功能不可用。这段代码会引起死锁，线程1和2互相等待对方释放锁。
3.资源限制的挑战
资源限制是指在进行并发编程时，程序的执行速度受限于计算机硬件资源或软件资源的限制。硬件资源限制有带宽的上传下载速度，
硬盘读写速度和CPU的处理速度。软件资源限制有数据库的连接数和socket连接数等。
并发编程将代码执行速度加速的原则是将代码中串行执行的部分变成并发执行，但是如果某段串行的代码并发执行，但是因为受限于
资源的限制，仍然在串行执行，这时候程序不仅不会执行加快，反而会更慢，因为增加了上下文切换和资源调度的时间。例如，之前
看到一段程序使用多线程在办公网并发的下载和处理数据时，导致CPU利用率100%，任务几个小时都不能运行完成，后来修改成单
线程，一个小时就执行完成了。
对于硬件资源限制，可以考虑使用集群并发执行程序，既然单机的资源有限制，那么就让程序在多机上运行，比如Hadoop或者自己搭
建服务器集群，不同的机器处理不同的数据，比如将数据ID%机器数，得到一个机器编号，然后由对应编号的机器处理这笔数据。
对于软件资源限制，可以考虑使用资源池将资源复用，比如使用连接池将数据库和socket连接复用，或者调用对方的webservice接口
获取数据时，只建立一个连接。
在资源限制的情况下，如何让程序执行的更快呢？根据不同的资源限制调整程序的并发度，比如下载文件程序依赖于两个资源，带宽和硬
盘读写速度。有数据库操作时，要数据库连接数，如果SQL语句执行非常快，而线程的数量比数据库连接数大很多，则某些线程会被阻塞住，
等待数据库连接。